from telegram import Update, ReplyKeyboardMarkup, KeyboardButton
from telegram.ext import ApplicationBuilder, CommandHandler, MessageHandler, ContextTypes, filters
import random
import os

TOKEN = os.getenv("TOKEN")

TEMPLATES = [
    "–ú—ã –ø–µ—Ä–µ—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –Ω–∞ —Ñ–æ–Ω–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –º–µ–Ω—è—é—â–µ–π—Å—è –ø–æ–≤–µ—Å—Ç–∫–∏.",
    "–° —É—á—ë—Ç–æ–º —Ç–µ–∫—É—â–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–∞–Ω–¥–∞ –Ω–µ –≥–æ—Ç–æ–≤–∞ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∂—ë—Å—Ç–∫–∏–µ —Å—Ä–æ–∫–∏.",
    "–í–æ–ø—Ä–æ—Å —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∏ –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è —Å–æ —Å—Ç–µ–π–∫—Ö–æ–ª–¥–µ—Ä–∞–º–∏.",
    "–ú—ã –≤–∏–¥–∏–º —Ä—è–¥ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π, –≤–ª–∏—è—é—â–∏—Ö –Ω–∞ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.",
    "–ù–∞ –¥–∞–Ω–Ω–æ–º —ç—Ç–∞–ø–µ —Ü–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω–æ –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏ —Å –±–æ–ª—å—à–µ–π –±–∏–∑–Ω–µ—Å-—Ü–µ–Ω–Ω–æ—Å—Ç—å—é.",
    "–ù—É–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ –æ–∂–∏–¥–∞–Ω–∏—è–º –∏ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Ä–æ–∂–Ω—É—é –∫–∞—Ä—Ç—É.",
    "–ú—ã –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–ª–∏ —Ä–∏—Å–∫–∏ –∏ –∑–∞–ª–æ–∂–∏–ª–∏ –∏—Ö –≤ —Ç–µ–∫—É—â–∏–π –ø–ª–∞–Ω –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è.",
    "–ó–∞–ø—Ä–æ—Å –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ —Ä–∞–º–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø—Ä–∏–Ω—Ç–∞ ‚Äî –≤–µ—Ä–Ω—ë–º—Å—è –≤ –æ–¥–Ω–æ–π –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –∏—Ç–µ—Ä–∞—Ü–∏–π.",
    "–ï—Å—Ç—å –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–µ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è –≤–∑–≤–µ—à–µ–Ω–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è.",
    "–ú—ã –≤–∏–¥–∏–º –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª, –Ω–æ –Ω–µ –º–æ–∂–µ–º –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–∂–∏–¥–∞–µ–º—ã–π —É—Ä–æ–≤–µ–Ω—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.",
    "–ü—Ä–µ–¥–ª–∞–≥–∞—é –æ—Ç–ª–æ–∂–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∏ —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á–∞—Ö.",
    "–ü–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ–±—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≥–∏–ø–æ—Ç–µ–∑—É.",
    "–°—Ü–µ–Ω–∞—Ä–∏–π —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.",
    "–ù—É–∂–Ω–æ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å –≤ –∏–∑–º–µ—Ä–∏–º—ã–µ KPI –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –¥–≤–∏–≥–∞—Ç—å—Å—è –¥–∞–ª—å—à–µ.",
    "–†–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–µ–µ –∑–∞—Ñ—Ä–∏–∑–∏—Ç—å –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É –¥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤.",
]

PENDING_CHATS: set[int] = set()

def to_corporate(text: str) -> str:
    template = random.choice(TEMPLATES)
    return f"–û—Ä–∏–≥–∏–Ω–∞–ª: ¬´{text}¬ª\n\n–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥:\n{template}"

def get_keyboard() -> ReplyKeyboardMarkup:
    keyboard = [[KeyboardButton("üéØ –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π")]]
    return ReplyKeyboardMarkup(keyboard, resize_keyboard=True)

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.effective_chat.send_message(
        "–ü—Ä–∏–≤–µ—Ç! –Ø –ø–µ—Ä–µ–≤–æ–∂—É —Ç–µ–∫—Å—Ç –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —è–∑—ã–∫.\n"
        "–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ ‚¨áÔ∏è",
        reply_markup=get_keyboard()
    )

async def handle_text(update: Update, context: ContextTypes.DEFAULT_TYPE):
    message = update.message
    if message is None:
        return

    chat_id = update.effective_chat.id
    text = message.text.strip()

    if text == "üéØ –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π":
        PENDING_CHATS.add(chat_id)
        await update.effective_chat.send_message("–û—Ç–ø—Ä–∞–≤—å —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏.")
        return

    if chat_id in PENDING_CHATS:
        result = to_corporate(text)
        await update.effective_chat.send_message(result)
        PENDING_CHATS.remove(chat_id)
        return

def main():
    app = ApplicationBuilder().token(TOKEN).build()
    app.add_handler(CommandHandler("start", start))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_text))

    print("üöÄ CorpBot –∑–∞–ø—É—â–µ–Ω...")
    app.run_polling()

if __name__ == "__main__":
    main()
